<% const collection="product" ; const linkPrefix=`/admin/${collection}/` ; const linkThumb='' ; const folderImage = '/products/' %>
    <div class="card card-info card-outline">
        <form action="<%= linkPrefix %>form/<%= item._id %>" method="POST" id="form-submit" class="mb-0" enctype="multipart/form-data">
            <div class="card-body">
                <h1>
                    <%= title %>
                </h1>

                <% if (alert && alert.length > 0) { %>
                    <% alert.forEach(error => { %>
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                            <%= error.msg %>
                            <button type="button" class="close" data-dismiss="alert" aria-label="close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    <% }) %>
                <% } %>

                <div class="form-group row">
                    <label for="name" class="col-sm-2 col-form-label text-sm-right required">Name</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" id="name-input-form" name="name" class="form-control form-control-sm"
                            value="<%= item.name %>">
                    </div>
                </div>           

                <div class="form-group row">
                    <label for="ordering" class="col-sm-2 col-form-label text-sm-right required">Ordering</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" name="ordering" class="form-control form-control-sm"
                            value="<%= item.ordering %>">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="status" class="col-sm-2 col-form-label text-sm-right">Status</label>
                    <div class="col-xs-12 col-sm-8">
                        <select id="status" name="status" class="custom-select custom-select-sm">
                            <option value="novalue">Choose Status</option>
                            <option value="active" <%=item.status==='active' ? 'selected' : '' %>>
                                Active</option>
                            <option value="inactive" <%=item.status==='inactive' ? 'selected' : '' %>>
                                Inactive</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="price" class="col-sm-2 col-form-label text-sm-right required">Price</label>
                    <div class="col-xs-12 col-sm-8">
                      <input type="number" name="price" class="form-control form-control-sm" value="<%= item.price || '' %>" />
                    </div>
                </div>

                <div class="form-group row">
                    <label for="type_discount" class="col-sm-2 col-form-label text-sm-right">Type Discount</label>
                    <div class="col-xs-12 col-sm-8">
                        <select id="type_discount" name="type_discount" class="custom-select custom-select-sm">
                            <option value="novalue">Choose discount</option>
                            <option value="%" <%=item.type_discount==='%' ? 'selected' : '' %>>
                                %</option>
                            <option value="price" <%=item.type_discount==='price' ? 'selected' : '' %>>
                                price</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="discount" class="col-sm-2 col-form-label text-sm-right required">Discount</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" name="discount" class="form-control form-control-sm"
                            value="<%= item.discount %>">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="price_discount" class="col-sm-2 col-form-label text-sm-right required">Price Discount</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" name="price_discount" class="form-control form-control-sm" value="<%= item.price_discount %>"> 
                    </div>
                </div>

                <div class="form-group row">
                    <label for="GroupCategory" class="col-sm-2 col-form-label text-sm-right">GroupCategory</label>
                    <div class="col-xs-12 col-sm-8">
                        <select class="custom-select custom-select-sm" name="idCategory" aria-label="Default select example">
                            <option value="novalue">Choose Group</option>
                            <% categories.forEach(e => { %>
                                <% if (e.status == 'active') { %>
                                    <option value="<%= e._id %>" <%= item.idCategory && item.idCategory.name == e.name ? "selected" : '' %>><%= e.name %></option>
                                <% } %>
                            <% }) %>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="GroupCategory" class="col-sm-2 col-form-label text-sm-right">GroupBrand</label>
                    <div class="col-xs-12 col-sm-8">
                        <select class="custom-select custom-select-sm" name="idBrand" aria-label="Default select example">
                            <option value="novalue">Choose Group</option>
                            <% brands.forEach(e => { %>
                                <% if (e.status == 'active') { %>
                                    <option value="<%= e._id %>" <%= item.idBrand && item.idBrand.name == e.name ? "selected" : '' %>><%= e.name %></option>
                                <% } %>
                            <% }) %>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="details_product" class="col-sm-2 col-form-label text-sm-right">Details Product</label>
                    <div class="col-xs-12 col-sm-8">
                      <textarea name="detail" id="edit" class="form-control form-control-sm"><%= item.detail || '' %></textarea>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="isSpecial" class="col-sm-2 col-form-label text-sm-right">Special</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="checkbox" name="isSpecial" class="form-control form-control-sm" id="isSpecial" <%= item.isSpecial ? 'checked' : '' %> />
                    </div>
                </div>

                <div class="form-group row">
                    <label for="newProduct" class="col-sm-2 col-form-label text-sm-right">New</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="checkbox" name="newProduct" class="form-control form-control-sm" id="isSpecial" <%= item.newProduct ? 'checked' : '' %> />
                    </div>
                </div>

                <!-- Image Upload Field for Main Image -->
                <div class="form-group row">
                    <label for="image" class="col-sm-2 col-form-label text-sm-right">Image</label>
                    <div class="col-xs-12 col-sm-8" upload-image>
                        <input type="file" name="image" class="form-control-file form-control-sm"  upload-image-input/>
                        <img src="/uploads<%= folderImage%><%= item.image %>" alt="" class="img-preview" upload-image-preview/>
                    </div>
                </div>
                
                <!-- Image Upload Field for Detail Images -->
                <div class="form-group row">
                    <label for="images" class="col-sm-2 col-form-label text-sm-right">Detail Images</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" name="images" class="form-control form-control-sm" id="images-input" multiple />
                        <div id="imageContainer">
                            <% if (item.images && item.images.length> 0) { %>
                                <% item.images.forEach((image, index)=> { %>
                                    <div class="image-preview">
                                        <img src="/uploads<%= folderImage %><%= item.image %>" alt="Product Detail Image <%= index + 1 %>"
                                            style="max-width: 100px; max-height: 100px;" />
                                        <button type="button" class="btn btn-sm btn-danger deleteButton"
                                            data-index="<%= index %>">Delete</button>
                                    </div>
                                <% }); %>
                            <% } %>
                        </div>
                    </div>
                </div>

            <div class="card-footer">
                <div class="col-12 col-sm-8 offset-sm-2">
                    <button type="submit" class="btn btn-sm btn-success mr-1">
                        <%= item._id ? 'Update': 'Add' %></button>
                    <a href="<%= linkPrefix %>" class="btn btn-sm btn-danger mr-1">
                        Cancel</a>
                </div>
            </div>
        </form>
    </div>



    <script>
        document.getElementById('images-input').addEventListener('change', function(event) {
          const files = event.target.files;
          const imageContainer = document.getElementById('imageContainer');
          imageContainer.innerHTML = ''; // Xóa các preview trước đó
      
          Array.from(files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
              const imageWrapper = document.createElement('div');
              imageWrapper.className = 'image-preview';
      
              const imgElement = document.createElement('img');
              imgElement.src = e.target.result;
              imgElement.style.maxWidth = '200px';
              imgElement.style.maxHeight = '200px';
      
              const deleteButton = document.createElement('button');
              deleteButton.className = 'btn btn-sm btn-danger deleteButton';
              deleteButton.textContent = 'Delete';
              deleteButton.type = 'button';
      
              deleteButton.addEventListener('click', function() {
                imageWrapper.remove();
              });
      
              imageWrapper.appendChild(imgElement);
              imageWrapper.appendChild(deleteButton);
              imageContainer.appendChild(imageWrapper);
            };
            reader.readAsDataURL(file);
          });
        });


        document.getElementById('type_discount').addEventListener('change', function () {
                var typeDiscount = this.value;
                var priceDiscountInput = document.querySelector('input[name="price_discount"]');
                var discountInput = document.querySelector('input[name="discount"]');

                if (typeDiscount === '%') {
                    priceDiscountInput.setAttribute('readonly', true);
                    discountInput.removeAttribute('readonly');
                } else if (typeDiscount === 'price') {
                    discountInput.setAttribute('readonly', true);
                    priceDiscountInput.removeAttribute('readonly');
                } else {
                    // Reset nếu không chọn gì
                    priceDiscountInput.removeAttribute('readonly');
                    discountInput.removeAttribute('readonly');
                }
            });

            // Kiểm tra trạng thái khi trang tải lại
            window.addEventListener('DOMContentLoaded', function () {
                var typeDiscount = document.getElementById('type_discount').value;
                var priceDiscountInput = document.querySelector('input[name="price_discount"]');
                var discountInput = document.querySelector('input[name="discount"]');

                if (typeDiscount === '%') {
                    priceDiscountInput.setAttribute('readonly', true);
                    discountInput.removeAttribute('readonly');
                } else if (typeDiscount === 'price') {
                    discountInput.setAttribute('readonly', true);
                    priceDiscountInput.removeAttribute('readonly');
                }
            });
      </script>
