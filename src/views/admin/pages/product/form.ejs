<% const collection="product" ; const linkPrefix=`/admin/${collection}/` ; const linkThumb='' ; const folderImage = '/products/' %>
    <div class="card card-info card-outline">
        <form action="<%= linkPrefix %>form/<%= item._id %>" method="POST" class="mb-0" enctype="multipart/form-data">
            <div class="card-body">
                <h1>
                    <%= title %>
                </h1>

                <% if (alert && alert.length > 0) { %>
                    <% alert.forEach(error => { %>
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                            <%= error.msg %>
                            <button type="button" class="close" data-dismiss="alert" aria-label="close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    <% }) %>
                <% } %>

                <div class="form-group row">
                    <label for="name" class="col-sm-2 col-form-label text-sm-right required">Name</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" id="name-input-form" name="name" class="form-control form-control-sm"
                            value="<%= item.name %>">
                    </div>
                </div>           

                <div class="form-group row">
                    <label for="name" class="col-sm-2 col-form-label text-sm-right required">Ordering</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="text" name="ordering" class="form-control form-control-sm"
                            value="<%= item.ordering %>">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="status" class="col-sm-2 col-form-label text-sm-right">Status</label>
                    <div class="col-xs-12 col-sm-8">
                        <select id="status" name="status" class="custom-select custom-select-sm">
                            <option value="novalue">Choose Status</option>
                            <option value="active" <%=item.status==='active' ? 'selected' : '' %>>
                                Active</option>
                            <option value="inactive" <%=item.status==='inactive' ? 'selected' : '' %>>
                                Inactive</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="price" class="col-sm-2 col-form-label text-sm-right required">Price</label>
                    <div class="col-xs-12 col-sm-8">
                      <input type="number" step="0.01" name="price" class="form-control form-control-sm" value="<%= item.price || '' %>" />
                    </div>
                </div>

                <div class="form-group row">
                    <label for="GroupCategory" class="col-sm-2 col-form-label text-sm-right">GroupCategory</label>
                    <div class="col-xs-12 col-sm-8">
                        <select class="custom-select custom-select-sm" name="idCategory" aria-label="Default select example">
                            <option value="novalue">Choose Group</option>
                            <% categories.forEach(e => { %>
                                <% if (e.status == 'active') { %>
                                    <option value="<%= e._id %>" <%= item.idCategory && item.idCategory.toString() === e._id.toString() ? "selected" : '' %>><%= e.name %></option>
                                <% } %>
                            <% }) %>
                          </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="details_product" class="col-sm-2 col-form-label text-sm-right">Details Product</label>
                    <div class="col-xs-12 col-sm-8">
                      <textarea name="detail" id="edit" class="form-control form-control-sm"><%= item.detail || '' %></textarea>
                    </div>
                </div>


                <!-- <div class="form-group row">
                    <label for="isSpecial" class="col-sm-2 col-form-label text-sm-right">Images</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" 
                            id="filepond"
                            class="filepond"
                            name="images" 
                            multiple 
                            data-allow-reorder="true"
                            data-max-file-size="3MB"
                            data-max-files="3">
                    </div>
                </div>
                
                <div class="form-group row">
                    <label for="image" class="col-sm-2 col-form-label text-sm-right">Image</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" name="image" class="form-control form-control-sm" id="imgInp" />
                        <img id="blah" src="/uploads<%= folderImage%><%= item.image %>" alt="" class="img-thumbnail mt-1 " width="200px" height="200px" />
                        <input type="hidden" name="old_image" value="<%= item.image %>">                
                    </div>
                </div> -->

                <!-- <div class="form-group row">
                    <label for="images" class="col-sm-2 col-form-label text-sm-right">Images</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" 
                            id="filepond-images"
                            name="images[]" 
                            class="filepond"
                            multiple 
                            data-max-file-size="3MB"
                            data-max-files="3">
                    </div>
                </div>
                
                <div class="form-group row">
                    <label for="image" class="col-sm-2 col-form-label text-sm-right">Image</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" 
                            id="filepond-image"
                            name="image" 
                            class="filepond">
                        <img id="image-preview" src="/uploads<%= folderImage %><%= item.image %>" alt="" class="img-thumbnail mt-1" width="200px" height="200px" />
                    </div>
                </div> -->

                <!-- Image Upload Field for Main Image -->
                <div class="form-group row">
                    <label for="image" class="col-sm-2 col-form-label text-sm-right">Main Image</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" name="image" class="form-control form-control-sm" id="image-input" />
                        <% if (item.image) { %>
                            <div id="mainImageContainer">
                                <img id="main-image-preview" src="/uploads/products/<%= item.image %>" alt="Product Main Image"
                                    style="max-width: 100px; max-height: 100px;" />
                            </div>
                            <% } else { %>
                                <div id="main-image-preview"></div>
                            <% } %>
                    </div>
                </div>
                
                <!-- Image Upload Field for Detail Images -->
                <div class="form-group row">
                    <label for="images" class="col-sm-2 col-form-label text-sm-right">Detail Images</label>
                    <div class="col-xs-12 col-sm-8">
                        <input type="file" name="images" class="form-control form-control-sm" id="images-input" multiple />
                        <div id="imageContainer">
                            <% if (item.images && item.images.length> 0) { %>
                                <% item.images.forEach((image, index)=> { %>
                                    <div class="image-preview">
                                        <img src="/uploads/products/<%= image %>" alt="Product Detail Image <%= index + 1 %>"
                                            style="max-width: 100px; max-height: 100px;" />
                                        <button type="button" class="btn btn-sm btn-danger deleteButton"
                                            data-index="<%= index %>">Delete</button>
                                    </div>
                                <% }); %>
                            <% } %>
                        </div>
                    </div>
                </div>

            <div class="card-footer">
                <div class="col-12 col-sm-8 offset-sm-2">
                    <button type="submit" class="btn btn-sm btn-success mr-1">
                        <%= item._id ? 'Update': 'Add' %></button>
                    <a href="<%= linkPrefix %>" class="btn btn-sm btn-danger mr-1">
                        Cancel</a>
                </div>
            </div>
        </form>
    </div>



    <script>
        document.getElementById('images-input').addEventListener('change', function(event) {
          const files = event.target.files;
          const imageContainer = document.getElementById('imageContainer');
          imageContainer.innerHTML = ''; // Xóa các preview trước đó
      
          Array.from(files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
              const imageWrapper = document.createElement('div');
              imageWrapper.className = 'image-preview';
      
              const imgElement = document.createElement('img');
              imgElement.src = e.target.result;
              imgElement.style.maxWidth = '200px';
              imgElement.style.maxHeight = '200px';
      
              const deleteButton = document.createElement('button');
              deleteButton.className = 'btn btn-sm btn-danger deleteButton';
              deleteButton.textContent = 'Delete';
              deleteButton.type = 'button';
      
              deleteButton.addEventListener('click', function() {
                imageWrapper.remove();
              });
      
              imageWrapper.appendChild(imgElement);
              imageWrapper.appendChild(deleteButton);
              imageContainer.appendChild(imageWrapper);
            };
            reader.readAsDataURL(file);
          });
        });
      </script>
